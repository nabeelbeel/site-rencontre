<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <title>Accueil</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.3/jquery.min.js"></script>
    <link type="text/css" rel="stylesheet" th:href="@{/css/style.css}">
</head>
<body onload="showUser(0)">
<div th:replace="fragments/header :: header"></div>
<div class="container my-md-4">
    <h1 class="text-light">Accueil</h1>
    <div class="container-xxl d-flex align-items-md-center">
        <th:block th:if="${session.active == true}">
            <h2 class="text-light py-4 position-relative me-auto" th:text="'Bonjour, ' + ${session.prenom}"></h2>
            <a th:href="@{/deconnexion}" class="btn btn-outline-light ms-3">Déconnexion</a>
        </th:block>
        <th:block th:unless="${session.active == true}">
            <h2 class="text-light py-4 position-relative me-auto">L'utilisateur n'est pas actif.</h2>
            <a th:href="@{/deconnexion}" class="btn btn-outline-light ms-3">Déconnexion</a>
        </th:block>
    </div>
    <h1 id="counter" class="text-light" style="display:none">0</h1>
    <h1 th:text="${emailUser}" id="userEmail" class="text-light" style="display:none"></h1>
    <div th:replace="fragments/swipe-screen :: swipe-screen"></div>
    <div class="container-xxl">
        <th:block th:if="${session.active == true}">
            <div class="d-flex flex-wrap">
                <th:block th:switch="${session.role}">
                    <th:block th:case="'Invite'">
                        <div class="card text-white bg-dark border-light mb-3 me-3"
                             style="min-width: 280px; max-width: 280px; min-height: 166px; max-height: 166px">
                            <div class="card-body">
                                <h5 class="card-title">Profil</h5>
                                <p class="card-text">Voir mon profil.</p>
                                <a th:href="@{/profile}" class="btn btn-outline-light">Entrer</a>
                            </div>
                        </div>
                        <div class="card text-white bg-dark border-light mb-3 me-3"
                             style="min-width: 280px; max-width: 280px; min-height: 166px; max-height: 166px">
                            <div class="card-body">
                                <h5 class="card-title">Membres</h5>
                                <p class="card-text">Voir la liste des membres.</p>
                                <a th:href="@{/listeMembres}" class="btn btn-outline-light">Entrer</a>
                            </div>
                        </div>
                    </th:block>
                    <th:block th:case="'Regulier'">
                        <div class="card text-white bg-dark border-light mb-3 me-3"
                             style="min-width: 280px; max-width: 280px; min-height: 166px; max-height: 166px">
                            <div class="card-body">
                                <h5 class="card-title">Profil</h5>
                                <p class="card-text">Voir mon profil.</p>
                                <a th:href="@{/profile}" class="btn btn-outline-light">Entrer</a>
                            </div>
                        </div>
                        <div class="card text-white bg-dark border-light mb-3 me-3"
                             style="min-width: 280px; max-width: 280px; min-height: 166px; max-height: 166px">
                            <div class="card-body">
                                <h5 class="card-title">Membres</h5>
                                <p class="card-text">Voir la liste des membres.</p>
                                <a th:href="@{/listeMembres}" class="btn btn-outline-light">Entrer</a>
                            </div>
                        </div>
                        <div class="card text-white bg-dark border-light mb-3 me-3"
                             style="min-width: 280px; max-width: 280px; min-height: 166px; max-height: 166px">
                            <div class="card-body">
                                <h5 class="card-title">Messages</h5>
                                <p class="card-text">Voir mes messages personnels.</p>
                                <a th:href="@{/messages}" class="btn btn-outline-light">Entrer</a>
                            </div>
                        </div>
                        <div class="card text-white bg-dark border-light mb-3 me-3"
                             style="min-width: 280px; max-width: 280px; min-height: 166px; max-height: 166px">
                            <div class="card-body">
                                <h5 class="card-title">Likes et favoris</h5>
                                <p class="card-text">Voir qui m'a liké et mes favoris
                                    personnels.</p>
                                <a th:href="@{/likes_favoris}" class="btn btn-outline-light">Entrer</a>
                            </div>
                        </div>
                    </th:block>
                    <th:block th:case="'Privilege'">
                        <div class="card text-white bg-dark border-light mb-3 me-3"
                             style="min-width: 280px; max-width: 280px; min-height: 166px; max-height: 166px">
                            <div class="card-body">
                                <h5 class="card-title">Profil</h5>
                                <p class="card-text">Voir mon profil.</p>
                                <a th:href="@{/profile}" class="btn btn-outline-light">Entrer</a>
                            </div>
                        </div>
                        <div class="card text-white bg-dark border-light mb-3 me-3"
                             style="min-width: 280px; max-width: 280px; min-height: 166px; max-height: 166px">
                            <div class="card-body">
                                <h5 class="card-title">Membres</h5>
                                <p class="card-text">Voir la liste des membres.</p>
                                <a th:href="@{/listeMembres}" class="btn btn-outline-light">Entrer</a>
                            </div>
                        </div>


                        <div class="card text-white bg-dark border-light mb-3 me-3"
                             style="min-width: 280px; max-width: 280px; min-height: 166px; max-height: 166px">
                            <div class="card-body">
                                <h5 class="card-title">Messages</h5>
                                <p class="card-text">Voir mes messages personnels.</p>
                                <a th:href="@{/messages}" class="btn btn-outline-light">Entrer</a>
                            </div>
                        </div>
                        <div class="card text-white bg-dark border-light mb-3 me-3"
                             style="min-width: 280px; max-width: 280px; min-height: 166px; max-height: 166px">
                            <div class="card-body">
                                <h5 class="card-title">Likes et favoris</h5>
                                <p class="card-text">Voir qui m'a liké et mes favoris
                                    personnels.</p>
                                <a th:href="@{/likes_favoris}" class="btn btn-outline-light">Entrer</a>
                            </div>
                        </div>
                    </th:block>
                    <th:block th:case="'Admin'">
                        <div class="card text-white bg-dark border-light mb-3 me-3 h-100"
                             style="min-width: 280px; max-width: 280px; min-height: 166px; max-height: 166px">
                            <div class="card-body">
                                <h5 class="card-title">Administration</h5>
                                <p class="card-text">Ajouter, modifier ou supprimer un membre.</p>
                                <a th:href="@{/administration}" class="btn btn-outline-light">Entrer</a>
                            </div>
                        </div>
                        <div class="card text-white bg-dark border-light mb-3 me-3 h-100"
                             style="min-width: 280px; max-width: 280px; min-height: 166px; max-height: 166px">
                            <div class="card-body">
                                <h5 class="card-title">Messages</h5>
                                <p class="card-text">Voir mes messages personnels.</p>
                                <a th:href="@{/messages}" class="btn btn-outline-light">Entrer</a>
                            </div>
                        </div>
                    </th:block>
                </th:block>
            </div>
        </th:block>
        <br>
        <h3 class="text-white mb-3">Membres en ligne</h3>
        <div class="d-flex flex-wrap">
            <th:block th:each="user: ${listeUtilisateurs}">
                <th:block th:if="${user.online == true}">
                    <div class="card text-white bg-dark border-success mb-3 me-3"
                         style="min-width: 18rem; max-width: 18rem;">
                        <div class="card-body">
                            <div class="container d-flex align-items-center">
                                <img th:alt="${user.nom}" th:src="@{'/download/' + ${user.photoFileName}}"
                                     class="position-relative"
                                     height="60" width="60" style="border-radius: 50%; object-fit: cover"/>
                                <div class="d-flex flex-column">
                                    <span th:text="${user.prenom}" class="fs-6 text-left ms-3"></span>
                                    <span th:text="${user.nom}" class="fs-6 text-left ms-3"></span>
                                </div>
                            </div>
                        </div>
                    </div>
                </th:block>
            </th:block>
        </div>
        <div th:unless="${session.active == true}"></div>
        <a class="share-email mb-4 mt-4"
           href="mailto:?subject=Invitation &amp;body=Vous pourriez être interessé à ce site web:  ///">Partager le
            site</a>
    </div>
</div>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
        crossorigin="anonymous"></script>
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js" type="text/javascript"></script>
<script>
    function nextUser() {
        $("*[id^='div-user-']").each(function () {
            $(this).hide();
        })
        let lenght = $("*[id^='div-user-']").length;
        let counter = parseInt($('#counter').text());
        $('#counter').text(counter += 1);
        if (counter === lenght) {
            $('#counter').text(0);
            counter = parseInt($('#counter').text());
        }
        showUser(counter);
    }

    function showUser(id) {
        $('#div-user-' + id).fadeIn();
    }


    function likeUser(email) {
        $.ajax({
            type: "POST",
            url: "/likeUser",
            data: {
                fromEmail: $('#userEmail').text(),
                toEmail: email
            },
            success: function (data) {
                if (data === 'Success') {
                    nextUser();
                } else {
                    alert("Vous avez déjà liké ce membre")
                    nextUser();
                }
            },

        });


    }

    function favoriUser(email) {
        $.ajax({
            type: "POST",
            url: "/favoriUser",
            data: {
                fromEmail: $('#userEmail').text(),
                toEmail: email
            },
            success: function (data) {
                if (data === 'Success') {
                    nextUser();
                } else {
                    alert("Vous avez déjà mis en favoris ce membre")
                    nextUser();
                }
            },

        });


    }
  /*  {
        "appId": "com.example.app",
        "appName": "recover",
        "webDir": "www"}
*/
</script>
</body>
</html>
